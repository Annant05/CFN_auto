{"AWSTemplateFormatVersion": "2010-09-09", "Description": "AWS CloudFormation Template EC2InstanceWithSecurityGroup: Create 4 Amazon EC2 instances.", "Mappings": {"AWSInstanceType2Arch": {"t1.micro": {"Arch": "HVM64"}, "t2.2xlarge": {"Arch": "HVM64"}, "t2.large": {"Arch": "HVM64"}, "t2.medium": {"Arch": "HVM64"}, "t2.micro": {"Arch": "HVM64"}, "t2.nano": {"Arch": "HVM64"}, "t2.small": {"Arch": "HVM64"}, "t2.xlarge": {"Arch": "HVM64"}, "t3.2xlarge": {"Arch": "HVM64"}, "t3.large": {"Arch": "HVM64"}, "t3.medium": {"Arch": "HVM64"}, "t3.micro": {"Arch": "HVM64"}, "t3.nano": {"Arch": "HVM64"}, "t3.small": {"Arch": "HVM64"}, "t3.xlarge": {"Arch": "HVM64"}, "t3a.2xlarge": {"Arch": "HVM64"}, "t3a.large": {"Arch": "HVM64"}, "t3a.medium": {"Arch": "HVM64"}, "t3a.micro": {"Arch": "HVM64"}, "t3a.nano": {"Arch": "HVM64"}, "t3a.small": {"Arch": "HVM64"}, "t3a.xlarge": {"Arch": "HVM64"}}, "AWSInstanceType2NATArch": {"t1.micro": {"Arch": "NATHVM64"}, "t2.2xlarge": {"Arch": "NATHVM64"}, "t2.large": {"Arch": "NATHVM64"}, "t2.medium": {"Arch": "NATHVM64"}, "t2.micro": {"Arch": "NATHVM64"}, "t2.nano": {"Arch": "NATHVM64"}, "t2.small": {"Arch": "NATHVM64"}, "t2.xlarge": {"Arch": "NATHVM64"}, "t3.2xlarge": {"Arch": "NATHVM64"}, "t3.large": {"Arch": "NATHVM64"}, "t3.medium": {"Arch": "NATHVM64"}, "t3.micro": {"Arch": "NATHVM64"}, "t3.nano": {"Arch": "NATHVM64"}, "t3.small": {"Arch": "NATHVM64"}, "t3.xlarge": {"Arch": "NATHVM64"}, "t3a.2xlarge": {"Arch": "NATHVM64"}, "t3a.large": {"Arch": "NATHVM64"}, "t3a.medium": {"Arch": "NATHVM64"}, "t3a.micro": {"Arch": "NATHVM64"}, "t3a.nano": {"Arch": "NATHVM64"}, "t3a.small": {"Arch": "NATHVM64"}, "t3a.xlarge": {"Arch": "NATHVM64"}}, "AWSRegionArch2AMI": {"ap-southeast-1": {"HVM64": "ami-061eb2b23f9f8839c"}, "ap-south-1": {"HVM64": "ami-009110a2bf8d7dd0a"}, "us-east-1": {"HVM64": "ami-04b9e92b5572fa0d1"}}}, "Resources": {"AllowSSH": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable SSH access via port 22", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "22", "ToPort": "22", "CidrIp": "0.0.0.0/0"}]}}, "AllowHTTPandHTTPS": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable HTTP and HTTPS ", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "80", "ToPort": "80", "CidrIp": "0.0.0.0/0"}, {"IpProtocol": "tcp", "FromPort": "443", "ToPort": "443", "CidrIp": "0.0.0.0/0"}]}}, "AllowMYSQL": {"Type": "AWS::EC2::SecurityGroup", "Properties": {"GroupDescription": "Enable MYSQL access port ", "SecurityGroupIngress": [{"IpProtocol": "tcp", "FromPort": "3306", "ToPort": "3306", "CidrIp": "0.0.0.0/0"}]}}, "server1": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t3a.nano", "SecurityGroups": [{"Ref": "AllowSSH"}, {"Ref": "AllowHTTPandHTTPS"}, {"Ref": "AllowMYSQL"}], "KeyName": "pro1", "Tags": [{"Key": "Owner", "Value": "Ansible-Cloudformation"}, {"Key": "Name", "Value": "CFN_server1"}], "ImageId": {"Fn::FindInMap": ["AWSRegionArch2AMI", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["AWSInstanceType2Arch", "t3a.nano", "Arch"]}]}}}, "server2": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t3a.nano", "SecurityGroups": [{"Ref": "AllowSSH"}, {"Ref": "AllowHTTPandHTTPS"}, {"Ref": "AllowMYSQL"}], "KeyName": "pro1", "Tags": [{"Key": "Owner", "Value": "Ansible-Cloudformation"}, {"Key": "Name", "Value": "CFN_server2"}], "ImageId": {"Fn::FindInMap": ["AWSRegionArch2AMI", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["AWSInstanceType2Arch", "t3a.nano", "Arch"]}]}}}, "server3": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t3a.nano", "SecurityGroups": [{"Ref": "AllowSSH"}, {"Ref": "AllowHTTPandHTTPS"}, {"Ref": "AllowMYSQL"}], "KeyName": "pro1", "Tags": [{"Key": "Owner", "Value": "Ansible-Cloudformation"}, {"Key": "Name", "Value": "CFN_server3"}], "ImageId": {"Fn::FindInMap": ["AWSRegionArch2AMI", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["AWSInstanceType2Arch", "t3a.nano", "Arch"]}]}}}, "server4": {"Type": "AWS::EC2::Instance", "Properties": {"InstanceType": "t3a.nano", "SecurityGroups": [{"Ref": "AllowSSH"}, {"Ref": "AllowHTTPandHTTPS"}, {"Ref": "AllowMYSQL"}], "KeyName": "pro1", "Tags": [{"Key": "Owner", "Value": "Ansible-Cloudformation"}, {"Key": "Name", "Value": "CFN_server4"}], "ImageId": {"Fn::FindInMap": ["AWSRegionArch2AMI", {"Ref": "AWS::Region"}, {"Fn::FindInMap": ["AWSInstanceType2Arch", "t3a.nano", "Arch"]}]}}}}, "Outputs": {"server1IPv4": {"Description": "Public IP address of the newly created EC2 instance", "Value": {"Fn::GetAtt": ["server1", "PublicIp"]}}, "server2IPv4": {"Description": "Public IP address of the newly created EC2 instance", "Value": {"Fn::GetAtt": ["server2", "PublicIp"]}}, "server3IPv4": {"Description": "Public IP address of the newly created EC2 instance", "Value": {"Fn::GetAtt": ["server3", "PublicIp"]}}, "server4IPv4": {"Description": "Public IP address of the newly created EC2 instance", "Value": {"Fn::GetAtt": ["server4", "PublicIp"]}}}}